---
keywords: fastai
title: Localized wallpaper
badges: true
categories: [code]
nb_path: _notebooks/2018-09-20-localize-wallpaper.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2018-09-20-localize-wallpaper.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I built a wallpaper switching script to help me be aware of the day outside my computer.</p>
<p>It uses a python package called <code>astral</code> to test whether the time is before or after local sunset (this changes with the seasons, of course).</p>
<p>Then the script automatically downloads a photo from a live webcam on top of a local TV station, sets it to be the background, and switches my local color scheme to light or dark themes as appropriate.</p>
<p>This runs on a cronjob, every 15 minutes, so that I have a slowly-updating view of the sun passing over the city all day.</p>
<p>Recently upgraded to astral v2. I want to clean up the hacky shell-script parts of it but I'll document them all below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">astral.sun</span> <span class="kn">import</span> <span class="n">sun</span>
<span class="kn">from</span> <span class="nn">astral.geocoder</span> <span class="kn">import</span> <span class="n">lookup</span><span class="p">,</span> <span class="n">database</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;US/Mountain&#39;</span><span class="p">)</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">tz</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>

<span class="n">city</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;Albuquerque&quot;</span><span class="p">,</span> <span class="n">database</span><span class="p">())</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">sun</span><span class="p">(</span><span class="n">city</span><span class="o">.</span><span class="n">observer</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">now</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dawn:    </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;dawn&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sunrise: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Noon:    </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;noon&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sunset:  </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dusk:    </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;dusk&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Now:     </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="p">))</span>

<span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;dawn&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">now</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;dusk&#39;</span><span class="p">]</span>    <span class="p">:</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;/home/maze/sol/walbuquerque.sh&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;/home/maze/sol/dark-walbuquerque.sh&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is the code for the shell scripts. I guess it's mostly the same, just one variable changed in the subprocess. When I was writing this in 2017 I didn't really understand how to craft a formatted string or template in python, so I just copied my shell scripts into a folder and hardwired the URL of the webcam</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">wwc</span><span class="o">.</span><span class="n">instacam</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">instacamimg</span><span class="o">/</span><span class="n">KOBTV</span><span class="o">/</span><span class="n">KOBTV_l</span><span class="o">.</span><span class="n">jpg</span> <span class="o">--</span><span class="n">output</span>  <span class="o">~/</span><span class="n">sol</span><span class="o">/</span><span class="n">kobtv</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">wal</span> <span class="o">--</span><span class="n">backend</span> <span class="n">colorthief</span> <span class="o">--</span><span class="n">saturate</span> <span class="mf">0.5</span> <span class="o">-</span><span class="n">li</span> <span class="o">~/</span><span class="n">sol</span><span class="o">/</span><span class="n">kobtv</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">oomoxify</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">spotify</span><span class="o">/</span><span class="n">Apps</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&quot;Input Mono&quot;</span> <span class="o">~/.</span><span class="n">cache</span><span class="o">/</span><span class="n">wal</span><span class="o">/</span><span class="n">colors</span><span class="o">-</span><span class="n">oomox</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">wwc</span><span class="o">.</span><span class="n">instacam</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">instacamimg</span><span class="o">/</span><span class="n">KOBTV</span><span class="o">/</span><span class="n">KOBTV_l</span><span class="o">.</span><span class="n">jpg</span> <span class="o">--</span><span class="n">output</span> <span class="o">~/</span><span class="n">sol</span><span class="o">/</span><span class="n">kobtv</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">wal</span> <span class="o">--</span><span class="n">backend</span> <span class="n">colorthief</span> <span class="o">--</span><span class="n">saturate</span> <span class="mf">0.5</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/</span><span class="n">sol</span><span class="o">/</span><span class="n">kobtv</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">oomoxify</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">spotify</span><span class="o">/</span><span class="n">Apps</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&quot;Input Mono&quot;</span> <span class="o">~/.</span><span class="n">cache</span><span class="o">/</span><span class="n">wal</span><span class="o">/</span><span class="n">colors</span><span class="o">-</span><span class="n">oomox</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I have some pictures of this on an old hard drive, I'll find them soon</p>

</div>
</div>
</div>
</div>
 

<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script>

