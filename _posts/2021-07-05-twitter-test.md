---
keywords: fastai
title: Can I extract tweets to this page
toc: true 
badges: true
comments: true
categories: [code, twitter]
hide: true
nb_path: _notebooks/2021-07-05-twitter-test.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-07-05-twitter-test.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I want to be able to programmatically scrape tweets from my account (and maybe others), push the URLs into a markdown cell, and let <code>fastpages</code> do the work of embedding the tweets in a blog page. I can use <code>twint</code> to get the tweets without using Twitter API. If replies are involved I might need more complicated data structures, but simple tweet-unrolling should be linear and straightforward.</p>
<p>First, I'll fetch the info about a top-level tweet. Then get all tweets from that user, to that user, filtered for conversation_id. TThen print them in chronological order to a markdown display! (Can it be so easy??)</p>
<p>The top level tweet is located at</p>

<pre><code>https://twitter.com/deepfates/status/1412086693713358850?s=20</code></pre>
<p>and should be displayed like
{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412086693713358850">https://twitter.com/deepfates/status/1412086693713358850</a>' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">op</span> <span class="o">=</span> <span class="s1">&#39;https://twitter.com/deepfates/status/1412086693713358850&#39;</span>
<span class="n">op_id</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://argh.tweeter.workers.dev/tw/metadata?id=</span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">twt</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">twt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;conversation_count&#39;: 16,
 &#39;created_at&#39;: &#39;2021-07-05T16:31:17.000Z&#39;,
 &#39;display_text_range&#39;: [0, 71],
 &#39;entities&#39;: {&#39;hashtags&#39;: [], &#39;symbols&#39;: [], &#39;urls&#39;: [], &#39;user_mentions&#39;: []},
 &#39;favorite_count&#39;: 42,
 &#39;id_str&#39;: &#39;1412086693713358850&#39;,
 &#39;lang&#39;: &#39;en&#39;,
 &#39;news_action_type&#39;: &#39;conversation&#39;,
 &#39;text&#39;: &#34;I&#39;m going to rebuild my personal website I think. what should look like&#34;,
 &#39;user&#39;: {&#39;id_str&#39;: &#39;3315205122&#39;,
  &#39;name&#39;: &#39;icd ⭐⭐⭐⭐✨&#39;,
  &#39;profile_image_url_https&#39;: &#39;https://pbs.twimg.com/profile_images/1406647367546327046/jp7tf-eW_normal.jpg&#39;,
  &#39;screen_name&#39;: &#39;deepfates&#39;,
  &#39;verified&#39;: False}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">twint</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">twint</span><span class="o">.</span><span class="n">Config</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">op_uname</span> <span class="o">=</span> <span class="n">twt</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
<span class="n">op_date</span> <span class="o">=</span> <span class="n">twt</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">op_id</span> <span class="o">=</span> <span class="n">twt</span><span class="p">[</span><span class="s1">&#39;id_str&#39;</span><span class="p">]</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">op_uname</span><span class="p">,</span> <span class="n">op_date</span><span class="p">,</span> <span class="n">op_id</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;deepfates&#39;, &#39;2021-07-05&#39;, &#39;1412086693713358850&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">To</span> <span class="o">=</span> <span class="n">op_uname</span>
<span class="n">c</span><span class="o">.</span><span class="n">By</span> <span class="o">=</span> <span class="n">op_uname</span>
<span class="n">c</span><span class="o">.</span><span class="n">Since</span> <span class="o">=</span> <span class="n">op_date</span>

<span class="n">c</span><span class="o">.</span><span class="n">Store_object</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">c</span><span class="o">.</span><span class="n">Store_object_tweets_list</span> <span class="o">=</span> <span class="n">tweets</span>

<span class="n">twint</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">self_replies</span> <span class="o">=</span> <span class="p">[</span><span class="n">tweet</span> <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span> <span class="k">if</span> <span class="n">tweet</span><span class="o">.</span><span class="n">conversation_id</span> <span class="o">==</span> <span class="n">op_id</span> <span class="ow">and</span> <span class="n">tweet</span><span class="o">.</span><span class="n">reply_to</span> <span class="o">==</span> <span class="p">[]]</span>

<span class="n">self_replies</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">link</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">self_replies</span><span class="p">]</span>
<span class="n">urls</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">templated_links</span> <span class="o">=</span> <span class="s1">&#39;&gt;twitter: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&gt;twitter: &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;These should be the appropriate links: </span><span class="se">\n\n</span><span class="s1">&gt;twitter: </span>
<span class="si">{</span><span class="n">templated_links</span><span class="si">}</span><span class="s1"></span>
<span class="s1">   &#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea output_execute_result">
<p>These should be the appropriate links:</p>
<blockquote><p>twitter: 
twitter: <a href="https://twitter.com/deepfates/status/1412088138403565570">https://twitter.com/deepfates/status/1412088138403565570</a></p>
<p>twitter: <a href="https://twitter.com/deepfates/status/1412088298714042370">https://twitter.com/deepfates/status/1412088298714042370</a></p>
<p>twitter: <a href="https://twitter.com/deepfates/status/1412091539908706311">https://twitter.com/deepfates/status/1412091539908706311</a></p>
<p>twitter: <a href="https://twitter.com/deepfates/status/1412093548581818373">https://twitter.com/deepfates/status/1412093548581818373</a></p>
<p>twitter: <a href="https://twitter.com/deepfates/status/1412094653780959232">https://twitter.com/deepfates/status/1412094653780959232</a></p>
<p>twitter: <a href="https://twitter.com/deepfates/status/1412097678759038982">https://twitter.com/deepfates/status/1412097678759038982</a></p>
<p>twitter: <a href="https://twitter.com/deepfates/status/1412099130776768513">https://twitter.com/deepfates/status/1412099130776768513</a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If I make a raw cell and copy the <code>% include</code> magic from the converted post, I can get it to show up:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412097678759038982">https://twitter.com/deepfates/status/1412097678759038982</a>' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And I can make one programmatically, but I can't figure out how to insert that as the next cell.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">include</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;{</span><span class="si">% i</span><span class="s1">nclude twitter.html content=&#39;&lt;a href=&quot;https://twitter.com/deepfates/status/1412097678759038982&quot;&gt;https://twitter.com/deepfates/status/1412097678759038982&lt;/a&gt;&#39; %}&#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">nbformat</span> <span class="k">as</span> <span class="nn">nbf</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">raw_cell</span> <span class="o">=</span> <span class="n">nbf</span><span class="o">.</span><span class="n">v4</span><span class="o">.</span><span class="n">new_raw_cell</span><span class="p">(</span><span class="n">include</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">raw_cell</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea ">
<pre>{&#39;cell_type&#39;: &#39;raw&#39;,
 &#39;source&#39;: &#39;{% include twitter.html content=\&#39;&lt;a href=&#34;https://twitter.com/deepfates/status/1412097678759038982&#34;&gt;https://twitter.com/deepfates/status/1412097678759038982&lt;/a&gt;\&#39; %}&#39;,
 &#39;metadata&#39;: {}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.getipython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
<span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shell</span><span class="o">.</span><span class="n">set_next_input</span><span class="p">(</span><span class="n">templated_links</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412088138403565570">https://twitter.com/deepfates/status/1412088138403565570</a>' %}{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412088298714042370">https://twitter.com/deepfates/status/1412088298714042370</a>' %}{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412091539908706311">https://twitter.com/deepfates/status/1412091539908706311</a>' %}{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412093548581818373">https://twitter.com/deepfates/status/1412093548581818373</a>' %}{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412094653780959232">https://twitter.com/deepfates/status/1412094653780959232</a>' %}{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412097678759038982">https://twitter.com/deepfates/status/1412097678759038982</a>' %}{% include twitter.html content='<a href="https://twitter.com/deepfates/status/1412099130776768513">https://twitter.com/deepfates/status/1412099130776768513</a>' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Well, if i want I can send them into a new cell and manually make it into a markdown cell and run it. That's reasonable. Alternatively, I could insert them into a new notebook entirely, as raw includes.</p>
<p>The other problem is that this Twitter embed includs the previous tweet, so the idea of posting abuch ofthem as a thread is kind of awkward. Might work better for a "popular tweets" post?</p>
<p>Yes... In fact, it could even be a notebook I run every so often taht prints to a .md file in the <code>pages</code> folder. All it has to have is YAML frontmatter and a list of includes...</p>

</div>
</div>
</div>
</div>
 

<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script>

