---
keywords: fastai
title: Book sales data collection
toc: true 
badges: true
comments: true
categories: [canon]
nb_path: _notebooks/2021-09-07-book-sales-data.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-09-07-book-sales-data.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Rationale">Rationale<a class="anchor-link" href="#Rationale"> </a></h2><p>I want another piece of information for the books in my dataset: their sales rank. I know it's possible to get this number from Amazon, because I have used professional bookseller software. However, this software requires a licensing agreement from Amazon, and it can only display sales rank data about one book ata time. So I need a different way to get it for a lot of books at once.</p>
<p>A starting point is the sales rank data available from Jianmo Ni's project here:</p>
<blockquote><p><a href="https://nijianmo.github.io/amazon/index.html">https://nijianmo.github.io/amazon/index.html</a></p>
<ul>
<li>Image-based recommendations on styles and substitutes, 
<pre><code>  J. McAuley, C. Targett, J. Shi, A. van den Hengel
  SIGIR, 2015
  draft</code></pre>
</li>
</ul>
</blockquote>
<p>In this notebook I extract those rankings and map them to the books in my previous <a href="/canon/2021/06/28/data-collation.html">Goodreads-based data</a>. Pretty similar process to that notebook, actually. Feel free to skip this and go straight to <a href="/canon/2021/06/28/sales-data-exploration.html">Sales data exploration</a> to see pretty graphs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I might be able to pull the metadata for all the books into one dataframe, but it's 4GB of JSON so I may run out of memory. Otherwise I'll have to chunk the JSON again.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">meta_json</span> <span class="o">=</span> <span class="n">LOCALPATH</span><span class="o">/</span><span class="s1">&#39;meta_Books.json&#39;</span>

<span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">meta_json</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">test_df</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">meta_df</span><span class="p">)</span>

<span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;asin&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span><span class="s1">&#39;category&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>asin</th>
      <th>title</th>
      <th>rank</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0000092878</td>
      <td>Biology Gods Living Creation Third Edition 10 ...</td>
      <td>1,349,781 in Books (</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>000047715X</td>
      <td>Mksap 16 Audio Companion: Medical Knowledge Se...</td>
      <td>1,702,625 in Books (</td>
      <td>[Books, New, Used &amp; Rental Textbooks, Medicine...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0000004545</td>
      <td>Flex! Discography of North American Punk, Hard...</td>
      <td>6,291,012 in Books (</td>
      <td>[Books, Arts &amp; Photography, Music]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0000013765</td>
      <td>Heavenly Highway Hymns: Shaped-Note Hymnal</td>
      <td>2,384,057 in Books (</td>
      <td>[Books, Arts &amp; Photography, Music]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0000000116</td>
      <td>Georgina Goodman Nelson Womens Size 8.5 Purple...</td>
      <td>11,735,726 in Books (</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>195</th>
      <td>0001839225</td>
      <td>Spring Story (Brambly Hedge)</td>
      <td>270,015 in Books (</td>
      <td>[Books, Children's Books, Animals]</td>
    </tr>
    <tr>
      <th>196</th>
      <td>0001942212</td>
      <td>Little Grey Rabbit and the Weasels (The Little...</td>
      <td>2,367,441 in Books (</td>
      <td>[Books, Children's Books]</td>
    </tr>
    <tr>
      <th>197</th>
      <td>0001942123</td>
      <td>Little Grey Rabbit's paint-box (The Little Gre...</td>
      <td>3,608,059 in Books (</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>198</th>
      <td>0001982869</td>
      <td>The Monster Book of Witches, Vampires, Spooks ...</td>
      <td>2,670,790 in Books (</td>
      <td>[Books, Children's Books, Humor]</td>
    </tr>
    <tr>
      <th>199</th>
      <td>0001983806</td>
      <td>Pookie Believes in Santa Claus</td>
      <td>2,047,631 in Books (</td>
      <td>[Books, Children's Books]</td>
    </tr>
  </tbody>
</table>
<p>200 rows Ã— 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">big_meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">meta_json</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">big_meta_df</span><span class="p">)):</span>
    <span class="n">filtered_chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[[</span><span class="s1">&#39;asin&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span><span class="s1">&#39;category&#39;</span><span class="p">]]</span>
    <span class="n">filtered_chunk</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;../../records/amazon-books</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>30it [03:03,  6.10s/it]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I have exported just the useful fields into local CSV files, for easy access. Now I want to transform the <code>rank</code> and <code>category</code> fields into useful datatypes: rank should be a number and category should be the last, most specific of the listed genres. ASINs are supposedly correlated to ISBN-10 numbers, so they should work decently out of the box.</p>
<p>First I'll write a couple small functions to turn the text strings of rank and category into the proper types. Then transform them through pandas, and write a total file to disk. Hopefully it will be small enough to keep in memory now that we've cut a lot of useless data and JSON syntax.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>

<span class="k">def</span> <span class="nf">rank_to_int</span><span class="p">(</span><span class="n">rank</span><span class="p">):</span>
<span class="c1"># This try/except loop is a piece of code written by the devil with my hands. Would not recommend</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="n">rank</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">num_str</span> <span class="o">=</span> <span class="n">rank</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">no_punc_str</span> <span class="o">=</span> <span class="n">num_str</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">no_punc_str</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">category_to_genre</span><span class="p">(</span><span class="n">category</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">category</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">category</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">category</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">category</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I'm sure that there is a prettier way to do this. But I'm hoping to only have to do it once more here, so I can brute force it a little bit. Next time I find myself doing this, though, it's time to figure out the smart-guy method.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;../../records/amazon-books</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">category_to_genre</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">rank_to_int</span><span class="p">)</span>
    
    <span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">total_df</span><span class="p">,</span><span class="n">df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 30/30 [00:23&lt;00:00,  1.29it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_df</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Collate-the-data">Collate the data<a class="anchor-link" href="#Collate-the-data"> </a></h2><p>What does the data look like, now that we can fit it into memory?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>asin</th>
      <th>title</th>
      <th>rank</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0000092878</td>
      <td>Biology Gods Living Creation Third Edition 10 ...</td>
      <td>1349781.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>000047715X</td>
      <td>Mksap 16 Audio Companion: Medical Knowledge Se...</td>
      <td>1702625.0</td>
      <td>Medicine&amp;HealthSciences</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0000004545</td>
      <td>Flex! Discography of North American Punk, Hard...</td>
      <td>6291012.0</td>
      <td>Music</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0000013765</td>
      <td>Heavenly Highway Hymns: Shaped-Note Hymnal</td>
      <td>2384057.0</td>
      <td>Music</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0000000116</td>
      <td>Georgina Goodman Nelson Womens Size 8.5 Purple...</td>
      <td>11735726.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2934944</th>
      <td>B01HJBPTUI</td>
      <td>Made Men: A Thriller (Law of Retaliation Book ...</td>
      <td>1436585.0</td>
      <td>Thrillers&amp;Suspense</td>
    </tr>
    <tr>
      <th>2934945</th>
      <td>B01HJC63ZM</td>
      <td>Raptor&amp;#39;s Desire (A Planet Desire novelette...</td>
      <td>1060621.0</td>
      <td>Erotica</td>
    </tr>
    <tr>
      <th>2934946</th>
      <td>B01HJEB422</td>
      <td>LG K4 Case,LG Optimus Zone 3 Case,LG Spree Cas...</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2934947</th>
      <td>B01HJDS76Y</td>
      <td>Magickal Incantations</td>
      <td>645067.0</td>
      <td>NewAge&amp;Spirituality</td>
    </tr>
    <tr>
      <th>2934948</th>
      <td>B01HJFHYMA</td>
      <td>White Away EURO 2016 Match Football Soccer Adu...</td>
      <td>5339602.0</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>2934949 rows Ã— 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I only have one continuous datapoint to work with here, the rank. Categorical and identifying points are great for labels, but not so much for graphing. I'd like to get more data.</p>
<p>Fortunately, the <code>asin</code> field can be used to map books from Amazon to Goodreads data. Let's grab that data from before.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="n">goodreads_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;../../records/cleaned_goodreads_books.csv&#39;</span><span class="p">)</span>
<span class="n">goodreads_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;Unnamed: 0&#39;, &#39;Unnamed: 0.1&#39;, &#39;Unnamed: 0.1.1&#39;, &#39;isbn&#39;,
       &#39;text_reviews_count&#39;, &#39;series&#39;, &#39;language_code&#39;, &#39;popular_shelves&#39;,
       &#39;asin&#39;, &#39;average_rating&#39;, &#39;similar_books&#39;, &#39;description&#39;, &#39;format&#39;,
       &#39;link&#39;, &#39;authors&#39;, &#39;publisher&#39;, &#39;num_pages&#39;, &#39;isbn13&#39;,
       &#39;publication_month&#39;, &#39;publication_year&#39;, &#39;url&#39;, &#39;image_url&#39;, &#39;book_id&#39;,
       &#39;ratings_count&#39;, &#39;work_id&#39;, &#39;title&#39;, &#39;top_genre&#39;, &#39;author_name&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">goodreads_df</span> <span class="o">=</span> <span class="n">goodreads_df</span><span class="p">[[</span><span class="s1">&#39;isbn&#39;</span><span class="p">,</span> <span class="s1">&#39;asin&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author_name&#39;</span><span class="p">,</span> <span class="s1">&#39;top_genre&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">,</span> <span class="s1">&#39;publication_year&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;num_pages&#39;</span><span class="p">,</span> <span class="s1">&#39;average_rating&#39;</span><span class="p">,</span> <span class="s1">&#39;ratings_count&#39;</span><span class="p">,</span> <span class="s1">&#39;text_reviews_count&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's map the Amazon sales rank values into the goodreads dataframe as new columns. Have to do two groups, some have ASIN as their index.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">isbns</span> <span class="o">=</span> <span class="n">goodreads_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">goodreads_df</span><span class="p">[</span><span class="s1">&#39;isbn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;asin&#39;</span><span class="p">])]</span>
<span class="n">asins</span> <span class="o">=</span> <span class="n">goodreads_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">goodreads_df</span><span class="p">[</span><span class="s1">&#39;asin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;asin&#39;</span><span class="p">])]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">isbns</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">asins</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(532698, 513)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">asins_full_df</span> <span class="o">=</span> <span class="n">asins</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;asin&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;asin&#39;</span><span class="p">,</span> <span class="n">lsuffix</span><span class="o">=</span><span class="s1">&#39;_gr&#39;</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s1">&#39;_az&#39;</span><span class="p">)</span>
<span class="n">isbns_full_df</span> <span class="o">=</span> <span class="n">isbns</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;asin&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;isbn&#39;</span><span class="p">,</span> <span class="n">lsuffix</span><span class="o">=</span><span class="s1">&#39;_gr&#39;</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s1">&#39;_az&#39;</span><span class="p">)</span>
<span class="n">full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">isbns_full_df</span><span class="p">,</span> <span class="n">asins_full_df</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Final-dataset">Final dataset<a class="anchor-link" href="#Final-dataset"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">full_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isbn</th>
      <th>asin</th>
      <th>title_gr</th>
      <th>author_name</th>
      <th>top_genre</th>
      <th>publisher</th>
      <th>publication_year</th>
      <th>format</th>
      <th>num_pages</th>
      <th>average_rating</th>
      <th>ratings_count</th>
      <th>text_reviews_count</th>
      <th>description</th>
      <th>title_az</th>
      <th>rank</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0312853122</td>
      <td>NaN</td>
      <td>W.C. Fields: A Life on Film</td>
      <td>Ronald J. Fields</td>
      <td>p</td>
      <td>St. Martin's Press</td>
      <td>1984.0</td>
      <td>Paperback</td>
      <td>256.0</td>
      <td>4.00</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>W. C. Fields: A Life on Film</td>
      <td>3974312.0</td>
      <td>Biographies&amp;amp;Memoirs</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0850308712</td>
      <td>NaN</td>
      <td>Runic Astrology: Starcraft and Timekeeping in ...</td>
      <td>Nigel Pennick</td>
      <td>runes</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.40</td>
      <td>15.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>Runic Astrology: Starcraft and Timekeeping in ...</td>
      <td>2163024.0</td>
      <td>NewAge&amp;Spirituality</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0425040887</td>
      <td>NaN</td>
      <td>The Wanting of Levine</td>
      <td>Michael Halberstam</td>
      <td>read-gave-away</td>
      <td>Berkley Publishing Group</td>
      <td>1979.0</td>
      <td>Paperback</td>
      <td>NaN</td>
      <td>4.38</td>
      <td>12.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>The Wanting of Levine</td>
      <td>2453377.0</td>
      <td>Literature&amp;amp;Fiction</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1934876569</td>
      <td>NaN</td>
      <td>All's Fairy in Love and War (Avalon: Web of Ma...</td>
      <td>Rachel Roberts</td>
      <td>fantasy</td>
      <td>Seven Seas</td>
      <td>2009.0</td>
      <td>Paperback</td>
      <td>216.0</td>
      <td>4.22</td>
      <td>98.0</td>
      <td>6.0</td>
      <td>To Kara's astonishment, she discovers that a p...</td>
      <td>Avalon: Web of Magic Book 8: All's Fairy in Lo...</td>
      <td>1176771.0</td>
      <td>ScienceFiction&amp;amp;Fantasy</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0922915113</td>
      <td>NaN</td>
      <td>The Devil's Notebook</td>
      <td>Anton Szandor LaVey</td>
      <td>occult</td>
      <td>Feral House</td>
      <td>2000.0</td>
      <td>Paperback</td>
      <td>147.0</td>
      <td>3.81</td>
      <td>986.0</td>
      <td>39.0</td>
      <td>Wisdom, humor, and dark observations by the fo...</td>
      <td>The Devil's Notebook</td>
      <td>29944.0</td>
      <td>World</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1204491</th>
      <td>NaN</td>
      <td>B0007E28P4</td>
      <td>The Ballad Mongers: Rise of the Modern Folk Song</td>
      <td>Oscar Brand</td>
      <td>music</td>
      <td>Minerva Press/Funk &amp; Wagnalls/Reader's Digest ...</td>
      <td>1967.0</td>
      <td>Paperback</td>
      <td>256.0</td>
      <td>3.60</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>The folk song performer &amp; impresario presents ...</td>
      <td>The Ballad Mongers: Rise of the Modern Folk Song</td>
      <td>3051315.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1207326</th>
      <td>NaN</td>
      <td>B00005X8YJ</td>
      <td>The Best of Science Fiction</td>
      <td>Groff Conklin</td>
      <td>science-fiction</td>
      <td>NaN</td>
      <td>1946.0</td>
      <td>Hardcover</td>
      <td>NaN</td>
      <td>4.05</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>The Best of Science Fiction</td>
      <td>3313873.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1207326</th>
      <td>NaN</td>
      <td>B00005X8YJ</td>
      <td>The Best of Science Fiction</td>
      <td>Groff Conklin</td>
      <td>science-fiction</td>
      <td>NaN</td>
      <td>1946.0</td>
      <td>Hardcover</td>
      <td>NaN</td>
      <td>4.05</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>The Best of Science Fiction</td>
      <td>3313873.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1208053</th>
      <td>NaN</td>
      <td>B003UW4N76</td>
      <td>He Who Knows Himself Knows His Lord</td>
      <td>Muhammad Sa'id al-Jamal ar-Rifa'i ash-Shadhuli</td>
      <td>islam</td>
      <td>Sidi Muhammad Press</td>
      <td>2007.0</td>
      <td>Paperback</td>
      <td>157.0</td>
      <td>4.62</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>Presented by Shaykh Muhammad Sa'id al-Jamal al...</td>
      <td>He Who Knows Himself, Knows His Lord By Shaykh...</td>
      <td>3574865.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1208115</th>
      <td>NaN</td>
      <td>0996644725</td>
      <td>Destroyer of Light (Hades &amp; Persephone #2)</td>
      <td>Rachel Alexander</td>
      <td>mythology</td>
      <td>Rachel Alexander</td>
      <td>2016.0</td>
      <td>Paperback</td>
      <td>492.0</td>
      <td>4.42</td>
      <td>263.0</td>
      <td>23.0</td>
      <td>The marriage of Hades and Persephone blossoms ...</td>
      <td>Destroyer of Light</td>
      <td>902309.0</td>
      <td>Fantasy</td>
    </tr>
  </tbody>
</table>
<p>533227 rows Ã— 16 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Half a million datapoints. It's not as comprehensive as either dataset by itself, but it has consistent levels of metadata for each book. I think that will help to find good features in the data.</p>
<p>Saving to disk. I explore this next in <a href="/canon/2021/09/09/sales-data-exploration.html">Sales data exploration</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script>

